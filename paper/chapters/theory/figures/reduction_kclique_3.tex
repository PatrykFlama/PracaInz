\begin{figure}[h]
\centering
\begin{tikzpicture}[
    scale=0.95,
    ->,
    >=Stealth,
    node distance=14mm,
    state/.style={circle, draw, minimum size=8mm},
    small/.style={circle, draw, minimum size=5mm},
    accept/.style={circle, draw, double, minimum size=8mm},
    reject/.style={circle, draw, minimum size=8mm},
    tostart/.style={state, dashed, thick},
    every label/.style={font=\small}
]
    % wierzchołek startowy
    \node[draw,state,inner sep=2pt] (s) at (0,-2) {$q_{\lambda}$};

    % wierzchołek sink
    \node[draw,accept,inner sep=2pt] (sink) at (0,-4) {$\text{sink}_+$};
    \draw[->,thick] (s) -- (sink) node[midway,right] {$c$};
    \node[draw,reject,inner sep=2pt] (sink) at (1.5,-4) {$\text{sink}_-$};

    % wierzchołki przejściowe dla krawędzi p
    \node[draw,state,inner sep=1.5pt] (t1) at (-1.5,0) {$p_1$};
    \node[draw,state,inner sep=1.5pt] (tx) at (0,0) {$p_x$};
    \node[draw,state,inner sep=1.5pt] (tlast) at (1.5,0) {$p_k$};

    % krawędzie wyboru p
    \draw[->,thick] (s) -- (t1) node[midway,left] {$bin(1)$};
    \node at (-0.7,-0.2) {$\dots$};
    \draw[->,thick] (s) -- (tx) node[midway,above] {$bin(x)$};
    \node at (0.8,-0.2) {$\dots$};
    \draw[->,thick] (s) -- (tlast) node[midway,right] {$bin(k)$};

    % punkty docelowe dla krawędzi p
    \coordinate (tt1) at (-1.5, 1.5);
    \coordinate (ttx) at (0, 1.5);
    \coordinate (ttlast) at (1.5, 1.5);

    % krawędzie wyboru p
    \draw[->,dashed,thick] (t1) -- (tt1) node[midway,left] {$0$};
    \draw[->,dashed,thick] (tx) -- (ttx) node[midway,left] {$0$};
    \draw[->,dashed,thick] (tlast) -- (ttlast) node[midway,left] {$0$};


    % wierzchołki v
    \node[draw,state,inner sep=1.5pt] (v1) at (3,-0.4) {$v_{1}$};
    \node (vdots1) at (3,-1.1) {$\vdots$};
    \node[draw,state,inner sep=1.5pt] (vi) at (3,-2) {$v_{i}$};
    \node (vdots2) at (3,-2.7) {$\vdots$};
    \node[draw,state,inner sep=1.5pt] (vn) at (3,-3.6) {$v_{n}$};

    % krawędź testowa
    \node[draw,state,inner sep=2pt] (test) at (5,-2) {$ $};
    \draw[->,thick] (vi) -- (test) node[midway,above] {$t$};

    % sekcja weryfikacji wierzchołka
    \node[draw,tostart,inner sep=2pt] (vv1) at (8,-0.4) {$q_{\lambda}$};
    \node (vdots1) at (8,-1.1) {$\vdots$};
    \node[draw,state,inner sep=2pt] (vvi) at (8,-2) {$u_{i}$};
    \node (vdots1) at (8,-2.7) {$\vdots$};
    \node[draw,tostart,inner sep=2pt] (vvn) at (8,-3.6) {$q_{\lambda}$};

    \draw[->,thick] (test) -- (vv1) node[midway,above] {$bin(1)$};
    \draw[->,thick] (test) -- (vvi) node[midway,above] {$bin(i)$};
    \draw[->,thick] (test) -- (vvn) node[midway,above] {$bin(n)$};

    % sekcja wyboru
    % \node[draw,state,inner sep=2pt] (choicenode) at (8,-2) {$ $};
    % \draw[->,thick] (vvi) -- (choicenode) node[midway,above] {$c$};

    \node[draw,tostart,inner sep=2pt] (choice1) at (10,-1.1) {$q_{\lambda}$};
    \node[draw,state,inner sep=2pt] (choice2) at (10,-2.7) {$c_2$};
    \draw[->,thick] (vvi) -- (choice1) node[midway,above] {$0$};
    \draw[->,thick] (vvi) -- (choice2) node[midway,above] {$1$};

    % sekcja testu sąsiedztwa
    \node[accept, inner sep=1.5pt] (accept) at (12,-1.1) {};
    \node[reject, inner sep=1.5pt] (reject) at (12,-4.3) {};
    \draw[->,thick] (choice2) -- (accept) node[midway,right] {$bin(j) \ \text{s.t.} \ (i, j) \in E$};
    \draw[->,thick] (choice2) -- (reject) node[midway,right] {$bin(j) \ \text{s.t.} \ (i, j) \notin E$};

    \coordinate (label_end) at (15,-4.5);

    % zielona ramka
    \node[
        draw=green!60!black,
        thick,
        rounded corners,
        fit=(test)(vv1)(vvi)(vvn)(choice1)(choice2)(accept)(reject)(label_end),
        label={[green!60!black]above:dla każdego $v_i$}
    ] {};

\end{tikzpicture}
\caption{Konstrukcja automatu dla redukcji z k-klik, korzystająca z alfabetu o rozmiarze 3}
\label{fig:kclique3}
\end{figure}